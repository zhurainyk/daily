<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è®°ç‰Œå™¨</title>
    <style>
      #box {
        display: flex;
        justify-content: center;
        align-items: stretch;
        user-select: none;
      }

      .card {
        position: relative;
        border-radius: 10px;
        width: 60px;
        margin-top: 20px;
        height: 100px;
        background-color: #f5f5f5;
        margin-right: 10px;
        box-shadow: 0 5px 5px 0 #c9c9c9;
        font-size: 28px;
        padding-left: 10px;
      }

      .card--empty {
        color: #c3c3c3;
        opacity: 0.8;
      }

      .card--chosen {
        margin-top: 0;
      }

      .card::after {
        content: attr(count);
        position: absolute;
        bottom: 2px;
        right: 5px;
        color: #999;
        font-size: 18px;
      }

      .card--warning::after {
        color: red;
        font-weight: bold;
      }

      #btn-box {
        text-align: center;
        margin-top: 30px;
      }

      button {
        padding: 10px 30px;
        border-radius: 60px;
        background-color: orangered;
        color: #fff;
        font-size: 32px;
        border: 0;
        cursor: pointer;
        transition: all ease 0.3s;
        margin-right: 20px;
        outline: none;
      }

      button:hover {
        background-color: red;
        transform: scale(1.1);
      }

      .info {
        font-size: 14px;
        margin-top: 70px;
        color: #999;
      }
    </style>
  </head>

  <body>
    <div id="box"></div>
    <div class="info">
      <!-- <p>ä½œè€…: <a href="http://www.leelei.info">leelei</a></p> -->
      <p>
        ç”¨æ³•:
        é¼ æ ‡ã€ç‚¹å‡»ã€‘ç›´æ¥å‡ºç‰Œï¼Œæˆ–è€…ã€ç‚¹å‡»æ»‘åŠ¨ã€‘å‡ºç‰Œï¼Œå³é”®å•å‡»æŸå¼ ç‰Œå¯ä»¥å¢åŠ ç‰Œæ•°(ç”¨äºé˜²æ­¢ç‚¹é”™)
      </p>
      <p>
        é€‚ç”¨äº:
        æ–—åœ°ä¸»æ–°æ‰‹ï¼Œå¹¶ä¸”æ²¡æœ‰é’±ä¹°è®°ç‰Œå™¨ï¼Œå¹¶ä¸”ç»å¸¸å¼€ç€ç”µè„‘çš„æ—¶å€™é¡ºä¾¿æ‰‹æœºç©æ–—åœ°ä¸»
      </p>
    </div>
  </body>
  <script>
    //å¸¸é‡
    const arr = [3, 4, 5, 6, 7, 8, 9, 10, "J", "Q", "K", "A", 2, "ğŸ‘»"];
    const nums = [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 2];
    const TYPE_CHOSEN = " card--chosen";
    const TYPE_WARNING = " card--warning";
    const TYPE_EMPTY = " card--empty";
    //å‚¨å­˜å·²ç»é€‰æ‹©
    let chosenArr = [];

    //æ·»åŠ ç±»å
    function addClass(e, name) {
      if (e.className.indexOf(name) == -1) {
        e.className += name;
      }
    }
    //ç§»é™¤ç±»å
    function removeClass(e, name) {
      e.className = e.className.replace(name, "");
    }
    //åˆå§‹åŒ–å¡ç‰‡
    function initCards() {
      let box = document.getElementById("box");
      let frag = document.createDocumentFragment();
      for (let i = 0; i < 14; i++) {
        let ele = document.createElement("div");
        ele.className = "card" + TYPE_WARNING;
        ele.innerText = arr[i];
        ele.setAttribute("count", nums[i]);
        ele.setAttribute("index", i);
        frag.append(ele);
      }
      box.append(frag);
    }

    //åˆå§‹åŒ–è¾“å…¥
    function initSlideInput() {
      let cards = document.getElementsByClassName("card");
      //é¼ æ ‡æŒ‰ä¸‹æ—¶æ³¨å†Œ
      box.addEventListener("mousedown", installSlideInput);
      //é¼ æ ‡æŠ¬èµ·å¸è½½
      box.addEventListener("mouseup", uninstallSlideInput);
      box.addEventListener("mouseleave", uninstallSlideInput);
      //æ³¨å†Œæ»‘åŠ¨è¾“å…¥
      function installSlideInput() {
        Array.from(cards).forEach((e) => {
          e.addEventListener("mouseenter", slideSelect);
          e.addEventListener("mouseleave", slideSelect);
        });
      }
      //å¸è½½æ»‘åŠ¨è¾“å…¥
      function uninstallSlideInput() {
        Array.from(cards).forEach((e) => {
          e.removeEventListener("mouseenter", slideSelect);
          e.removeEventListener("mouseleave", slideSelect);
        });
        submit();
      }
      //ç‚¹å‡»è¾“å…¥,ä¸€ç›´æœ‰æ•ˆ
      Array.from(cards).forEach((e) => {
        e.addEventListener("click", function (event) {
          slideSelect(event);
          submit();
        });
      });
      //æ»‘åŠ¨è¾“å…¥
      function slideSelect(event) {
        let idx = event.currentTarget.getAttribute("index");
        if (event.currentTarget.className.indexOf(TYPE_CHOSEN) == -1) {
          addClass(event.currentTarget, TYPE_CHOSEN);
          chosenArr.push(idx);
        }
      }
    }

    //é‡ç½®å…¨éƒ¨ç‰Œçš„çŠ¶æ€ï¼Œå‡¸èµ·->å¯¹é½
    function reset() {
      chosenArr = [];
      let cards = document.getElementsByClassName("card");
      Array.from(cards).forEach((v, i) => {
        removeClass(v, TYPE_CHOSEN);
      });
    }

    //å‡ºç‰Œ
    function submit() {
      let cards = document.getElementsByClassName("card");
      chosenArr.forEach((v, i) => {
        cards[v].setAttribute("count", cards[v].getAttribute("count") - 1);
        removeClass(cards[v], TYPE_WARNING);
        if (cards[v].getAttribute("count") < 1) {
          //æœ€å°ä¸º0,è®¾ç½®ä¸ºç©ºçŠ¶æ€
          cards[v].setAttribute("count", 0);
          addClass(cards[v], TYPE_EMPTY);
        }
      });
      //é‡ç½®çŠ¶æ€
      reset();
    }
    //å³é”®åŠ ç‰Œï¼Œé˜²æ­¢å‡ºé”™ç‰Œ
    function addCardCount(e) {
      if (e.getAttribute("count") != undefined) {
        e.setAttribute("count", e.getAttribute("count") - 0 + 1);
      }
      if (e.getAttribute("count") >= nums[e.getAttribute("index")]) {
        e.setAttribute("count", nums[e.getAttribute("index")]);
        addClass(e, TYPE_WARNING);
      } else if (e.getAttribute("count") > 0) {
        removeClass(e, TYPE_EMPTY);
      }
    }

    window.onload = function () {
      document.oncontextmenu = function (event) {
        event.preventDefault();
        if (event.button == 2) {
          addCardCount(event.target);
        }
      };
      initCards();
      initSlideInput();
    };
  </script>
</html>
